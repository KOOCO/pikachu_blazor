@page "/GroupBuyManagement/GroupBuyList/Edit/{id}"

@using Kooco.Pikachu.EnumValues;
@using Kooco.Pikachu.GroupBuys;
@using Kooco.Pikachu.Items.Dtos;
@using Pikachu.Items;
@using Pikachu.Localization;
@using Microsoft.Extensions.Localization;
@using Volo.Abp.AspNetCore.Components.Web
@using System.ComponentModel
@using Blazorise.Components

@inject IGroupBuyAppService AppService
@inject NavigationManager NavigationManager
@inject IStringLocalizer<PikachuResource> L
@inject IMessageService _message
<script src="interop.js"></script>
<style>
    .row {
        margin-top: 10px;
    }

    .site-tag-plus {
        background: #fff;
        border-style: dashed;
    }
    /* you can make up upload button and sample style by using stylesheets */
    .ant-upload-select-picture-card i {
        color: #999;
        font-size: 32px;
    }
     .ant-upload-select-picture-card i {
        color: #999;
        font-size: 32px;
    }

    .ant-upload-select-picture-card .ant-upload-text {
        margin-top: 8px;
        color: #666;
    }

    .anticon {
        vertical-align: 0.1em !important
    }

</style>
  <h3>@L["EditGroupBuy"]</h3>
<Card >
   
 <CardBody>
        <div class="card-body">
        <div class="col-12"><h4>Sales URL</h4>  </div>
        <div class=" col-12 row">
             <div class="col-1"></div>
            <div class="col-2">
                <label>@L["SalesURL1"]</label>
            </div>
            <div class="col-7">
                <TextEdit @bind-Text="@EditGroupBuyDto.EntryURL" />
            </div>
           
            
        </div>
         <div class=" col-12 row">
              <div class="col-1"></div>
          <div class="col-2">
                <label>@L["SalesURL2"]</label>
            </div>
            <div class="col-7">
                <TextEdit @bind-Text="@EditGroupBuyDto.EntryURL2" />
            </div>
            </div>
            </div>
        <Divider></Divider>
         <div class=" col-12 row">
           
            <div class="col-2">
                <label>@L["GroupBuyName"]</label>
            </div>
            <div class="col-9">
                <TextEdit  MaxLength="@MaxtextCount" @bind-Text="@EditGroupBuyDto.GroupBuyName" />
            </div>
            <div class="col-1">
                        <span>
                            @(string.IsNullOrWhiteSpace(EditGroupBuyDto.GroupBuyName) ? 60 : (MaxtextCount - EditGroupBuyDto.GroupBuyName.Count()))/@MaxtextCount
                        </span>
                    </div>
            
        </div>
         <div class=" col-12 row">
          <div class="col-2">
                <label>@L["Subject"]</label>
            </div>
            <div class="col-9">
                <TextEdit  MaxLength="@MaxtextCount" @bind-Text="@EditGroupBuyDto.SubjectLine" />
            </div>
             <div class="col-1">
                        <span>
                            @(string.IsNullOrWhiteSpace(EditGroupBuyDto.SubjectLine) ? 60 : (MaxtextCount - EditGroupBuyDto.SubjectLine.Count()))/@MaxtextCount
                        </span>
                    </div>
            </div>
            <div class=" col-12 row">
          <div class="col-2">
                <label>@L["GroupBuyShortName"]</label>
            </div>
            <div class="col-9">
                <TextEdit  MaxLength="@MaxtextCount" @bind-Text="@EditGroupBuyDto.ShortName" />
            </div>
             <div class="col-1">
                        <span>
                            @(string.IsNullOrWhiteSpace(EditGroupBuyDto.ShortName) ? 60 : (MaxtextCount - EditGroupBuyDto.ShortName.Count()))/@MaxtextCount
                        </span>
                    </div>
            </div>
             <div class="col-12 row">
            <div class="col-2">
                <label>@L["GroupBuyLogo"]*</label>
            </div>
            <div class="col-10 row">
                
      <Field>
                            <FilePicker @ref="LogoPickerCustom"
                                       
                                        Changed="OnLogoUploadAsync"
                                        ShowMode="FilePickerShowMode.List"
                                        Accept=".jpg, .png, .svg,.jpeg,.webp">
                                <FileTemplate>
                                    <Div Flex="Flex.JustifyContent.Between">
                                        <Div>
                                            <Heading Size="HeadingSize.Is6">@context.File.Name</Heading>
                                            <Paragraph>@FilePicker.GetFileSizeReadable(context.File)</Paragraph>
                                        </Div>
                                        <Div Class="ps-2">
                                            <Div>
                                                 @if (context.File.Status == FileEntryStatus.Ready)
                                                {
                                                    <Icon TextColor="TextColor.Primary" Name="IconName.FileUpload" />
                                                }
                                                else if (context.File.Status == FileEntryStatus.Uploading)
                                                {
                                                    <Icon TextColor="TextColor.Warning" Name="IconName.Bolt" />
                                                }
                                                else if (context.File.Status == FileEntryStatus.Uploaded)
                                                {
                                                    <Icon TextColor="TextColor.Success" Name="IconName.CheckCircle" />
                                                }
                                                else if (context.File.Status == FileEntryStatus.Error)
                                                {
                                                    <Icon TextColor="TextColor.Danger" Name="IconName.TimesCircle" />
                                                }
                                            </Div>
                                            <Div>
                                                <Icon TextColor="TextColor.Danger" Name="IconName.Delete" class="cursor-pointer" Clicked="context.RemoveFile" />
                                            </Div>
                                        </Div>
                                    </Div>
                                </FileTemplate>
                                <ButtonsTemplate>
                                    <Progress Value="@LogoPickerCustom.GetProgressPercentage()" />
                                    @* <Buttons Class="mt-2 d-flex justify-content-end">
                                        <Button Clicked="@context.Clear" Color="Color.Warning"><Icon Name="IconName.Clear" /></Button>
                                        <Button Clicked="@context.Upload" Color="Color.Primary"><Icon Name="IconName.FileUpload" /></Button>
                                    </Buttons> *@
                                </ButtonsTemplate>
                            </FilePicker>
                        </Field>

            </div>
                @if(EditGroupBuyDto.LogoURL!=null)
                {
                    <div Class="col-12 row">
                        <div class="col-2"></div>
                        <div class="col-10">
                            <div class="image-list-container">
                               
                                    <div class="image-container">
                                        <Image class="blur-image" Source="@EditGroupBuyDto.LogoURL" Text="Logo Image" Fluid />
                                        <button class="delete-button" @onclick="() => DeleteLogoAsync(EditGroupBuyDto.BannerURL)">
                                            <i class="fa fa-trash"></i>
                                        </button>
                                    </div>
                             
                            </div>
                        </div>
                    </div>
                }
        </div>
             <div class="col-12 row">
            <div class="col-2">
                <label>@L["GroupBuyBanner"]</label>
            </div>
            <div class="col-10 row">
    <Field>
                            <FilePicker @ref="BannerPickerCustom"
                                       
                                        Changed="OnBannerUploadAsync"
                                        ShowMode="FilePickerShowMode.List"
                                        Accept=".jpg, .png, .svg ,.jpeg,.webp">
                                <FileTemplate>
                                    <Div Flex="Flex.JustifyContent.Between">
                                        <Div>
                                            <Heading Size="HeadingSize.Is6">@context.File.Name</Heading>
                                            <Paragraph>@FilePicker.GetFileSizeReadable(context.File)</Paragraph>
                                        </Div>
                                        <Div Class="ps-2">
                                            <Div>
                                                 @if (context.File.Status == FileEntryStatus.Ready)
                                                {
                                                    <Icon TextColor="TextColor.Primary" Name="IconName.FileUpload" />
                                                }
                                                else if (context.File.Status == FileEntryStatus.Uploading)
                                                {
                                                    <Icon TextColor="TextColor.Warning" Name="IconName.Bolt" />
                                                }
                                                else if (context.File.Status == FileEntryStatus.Uploaded)
                                                {
                                                    <Icon TextColor="TextColor.Success" Name="IconName.CheckCircle" />
                                                }
                                                else if (context.File.Status == FileEntryStatus.Error)
                                                {
                                                    <Icon TextColor="TextColor.Danger" Name="IconName.TimesCircle" />
                                                }
                                            </Div>
                                            <Div>
                                                <Icon TextColor="TextColor.Danger" Name="IconName.Delete" class="cursor-pointer" Clicked="context.RemoveFile" />
                                            </Div>
                                        </Div>
                                    </Div>
                                </FileTemplate>
                                <ButtonsTemplate>
                                    <Progress Value="@BannerPickerCustom.GetProgressPercentage()" />
                                    @* <Buttons Class="mt-2 d-flex justify-content-end">
                                        <Button Clicked="@context.Clear" Color="Color.Warning"><Icon Name="IconName.Clear" /></Button>
                                        <Button Clicked="@context.Upload" Color="Color.Primary"><Icon Name="IconName.FileUpload" /></Button>
                                    </Buttons> *@
                                </ButtonsTemplate>
                            </FilePicker>
                        </Field>

            </div>
                @if(EditGroupBuyDto.BannerURL!=null)
                {
                    <div Class="col-12 row">
                        <div class="col-2"></div>
                        <div class="col-10">
                            <div class="image-list-container">
                               
                                    <div class="image-container">
                                        <Image class="blur-image" Source="@EditGroupBuyDto.BannerURL" Text="Logo Image" Fluid />
                                        <button class="delete-button" @onclick="() => DeleteBannerAsync(EditGroupBuyDto.BannerURL)">
                                            <i class="fa fa-trash"></i>
                                        </button>
                                    </div>
                             
                            </div>
                        </div>
                    </div>
                }

           
        </div>
          <div class="col-12 row ">
            <div class="col-2">
                <label>@L["CarouselImages"]<Span><Tooltip Text="Upload upto 5 images">
    
<Icon class="fa-question-circle "></Icon></Tooltip></Span></label>
            </div>
            <div class="col-10 ">
     <Field>
                            <FilePicker @ref="CarouselPickerCustom"
                                        Multiple
                                        Changed="OnCarouselUploadAsync"
                                        ShowMode="FilePickerShowMode.List"
                                        Accept=".jpg, .png, .svg ,.jpeg,.webp">
                                <FileTemplate>
                                    <Div Flex="Flex.JustifyContent.Between">
                                        <Div>
                                            <Heading Size="HeadingSize.Is6">@context.File.Name</Heading>
                                            <Paragraph>@FilePicker.GetFileSizeReadable(context.File)</Paragraph>
                                        </Div>
                                        <Div Class="ps-2">
                                            <Div>
                                                 @if (context.File.Status == FileEntryStatus.Ready)
                                                {
                                                    <Icon TextColor="TextColor.Primary" Name="IconName.FileUpload" />
                                                }
                                                else if (context.File.Status == FileEntryStatus.Uploading)
                                                {
                                                    <Icon TextColor="TextColor.Warning" Name="IconName.Bolt" />
                                                }
                                                else if (context.File.Status == FileEntryStatus.Uploaded)
                                                {
                                                    <Icon TextColor="TextColor.Success" Name="IconName.CheckCircle" />
                                                }
                                                else if (context.File.Status == FileEntryStatus.Error)
                                                {
                                                    <Icon TextColor="TextColor.Danger" Name="IconName.TimesCircle" />
                                                }
                                            </Div>
                                            <Div>
                                                <Icon TextColor="TextColor.Danger" Name="IconName.Delete" class="cursor-pointer" Clicked="context.RemoveFile" />
                                            </Div>
                                        </Div>
                                    </Div>
                                </FileTemplate>
                                <ButtonsTemplate>
                                    <Progress Value="@CarouselPickerCustom.GetProgressPercentage()" />
                                </ButtonsTemplate>
                            </FilePicker>
                        </Field>

            </div>
                  @if(CarouselImages.Count > 0)
                {
                    <div Class="col-12 row">
                        <div class="col-2"></div>
                        <div class="col-10">
                            <div class="image-list-container">
                                @foreach (var image in CarouselImages)
                                {
                                    <div class="image-container">
                                        <Image class="blur-image" Source="@image.ImageUrl" Text="Carousel Image" Fluid />
                                        <button class="delete-button" @onclick="() => DeleteImageAsync(image.BlobImageName)">
                                            <i class="fa fa-trash"></i>
                                        </button>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                }
        </div>

           <Divider></Divider>
            <div class=" col-12 row">
                <div class="col-2">@L["GroupBuyTime"]</div>
                <div class="col-4">
                 
    
        <DateEdit  Class="form-control" @bind-Date=EditGroupBuyDto.StartTime  Placeholder="@L["StartDate"].ToString()" TValue="DateTime?"/>
   
    </div>
                 <div class="col-4">
                 
                     <DateEdit   Class="form-control"  @bind-Date=EditGroupBuyDto.EndTime  Placeholder="@L["EndDate"].ToString()" TValue="DateTime?"  />
  
   
                 </div>
            </div>
             <div class=" col-12 row">
                <div class="col-1">@L["Logistic"]</div>
                 <div class="col-2">@L["FreeShipping"]</div>
            
                 <div class="col-4"> <Switch TValue="bool" @bind-Checked="@EditGroupBuyDto.FreeShipping"></Switch></div>
            </div>
            <div class="col-12 row">
                <div class="col-1"></div>
               <div class="col-2">
                @L["ExcludeShippingMethod"]
            </div>
            <div class="col-8">
               
                            <div class="col-7 form-control"  style="background-color:white">
          @foreach (var item in ItemTags)
                            {
                                <Badge class="item-tags" CloseClicked="@(() => HandleItemTagDelete(item))">@item</Badge>
                            }

                            <div class="input-container">
                                <input type="text" id="tag-input" class="tag-input" placeholder="New Tag"
                                @bind-value="TagInputValue"
                                @onkeyup="HandleItemTagInputKeyUp" />
                                <i class="tag-input-placeholder-icon fa fa-plus"></i>
                            </div>
            </div>
         
            </div>
            
            </div>
                <div class=" col-12 row">
                <div class="col-1"></div>
                 <div class="col-2">@L["AllowShipToOuterIsland"]</div>
            
                 <div class="col-4"> <Switch TValue="bool" @bind-Checked="@EditGroupBuyDto.AllowShipToOuterTaiwan"></Switch></div>
            </div>
                <div class=" col-12 row">
                <div class="col-1"></div>
                 <div class="col-2">@L["AllowShipToOverSea"]</div>
            
                 <div class="col-4"> <Switch TValue="bool" @bind-Checked="@EditGroupBuyDto.AllowShipOversea"></Switch></div>
            </div>
               <div class=" col-12 row">
                   <div class="col-1"></div>
                <div class="col-2">@L["ExpectDeliveryDate"]</div>
                <div class="col-4"><DateEdit TValue="DateTime?" Class="form-control" @bind-Date=EditGroupBuyDto.ExpectShippingDateTo  Placeholder="@L["StartDate"].ToString()" /></div>
                 <div class="col-4"><DateEdit TValue="DateTime?"  Class="form-control" @bind-Date=EditGroupBuyDto.ExpectShippingDateFrom  Placeholder="@L["EndDate"].ToString()" /></div>
            </div>
          
              <div class="col-12 row">
                <div class="col-1">@L["GateWay"]</div>
                 <div class="col-2">@L["PaymentMethod"]</div>
            
                 <div class="col-4">  <Radio TValue="bool" Group="Payment" Value=EditGroupBuyDto.IsDefaultPaymentGateWay>
        @L["DefaultPaymentGateWay"]
    </Radio>
       </div>
            </div>
                   <div class="col-12 row">
                <div class="col-1"></div>
                 <div class="col-2"></div>
            
                 <div class="col-1">    <Radio TValue="bool" Group="Payment" Value="@PaymentMethodCheck" > </Radio></div>
                 <div class="col-7">
                     <div class="col-7 form-control"  style="background-color:white">
               @foreach (var item in PaymentMethodTags)
                            {
                                <Badge class="item-tags" CloseClicked="@(() => HandlePaymentTagDelete(item))">@item</Badge>
                            }

                            <div class="input-container">
                                <input type="text" id="tag-input" class="tag-input" placeholder="New Tag"
                                @bind-value="PaymentTagInputValue"
                                @onkeyup="HandlePaymentTagInputKeyUp" />
                                <i class="tag-input-placeholder-icon fa fa-plus"></i>
                            </div>
            </div>
                 </div>         
       
            </div>
             <div class=" col-12 row">
                <div class="col-1">@L["Invoice"]</div>
                 <div class="col-2">@L["IssueInvoice"]</div>
            
                 <div class="col-4"> <Switch TValue="bool" @bind-Checked="@EditGroupBuyDto.IssueInvoice"></Switch></div>
            </div>
           <div class=" col-12 row">
                <div class="col-1"></div>
                 <div class="col-2 form-label">@L["AutoIssueTriplicateInvoice"]</div>
            
                 <div class="col-4"> <Switch TValue="bool" @bind-Checked="@EditGroupBuyDto.AutoIssueTriplicateInvoice"></Switch></div>
            </div>
             <div class=" col-12 row">
                <div class="col-1"></div>
                 <div class="col-2 form-label">@L["InvoiceComment"]</div>
            
                 <div class="col-8"> <InputTextArea class="form-control"   maxlength="200" @bind-Value="@EditGroupBuyDto.InvoiceNote"></InputTextArea></div>
            </div>
            <Divider></Divider>
             <div class=" col-12 row">
                <div class="col-1 mx-1">@L["AdvanceSetting"]</div>
                 <div class="col-2 form-label">@L["HideCredention"]</div>
            
                 <div class="col-4"> <Switch TValue="bool" @bind-Checked="@EditGroupBuyDto.ProtectPrivacyData"></Switch></div>
            </div>
                <div class=" col-12 row">
           <div class="col-1"></div>
            <div class="col-2">
                <label>@L["InviteCode"]</label>
            </div>
            <div class="col-5">
                <TextEdit  @bind-Text="@EditGroupBuyDto.InviteCode" />
            </div>
           
            
        </div>
         <div class=" col-12 row">
              <div class="col-1"></div>
             <div class="col-2">
                <label>@L["ProfitShare"]</label>
            </div>
            <div class="col-5">
                <InputNumber class="form-control"   @bind-Value="@EditGroupBuyDto.ProfitShare" />
            </div>
            </div>
             <div class=" col-12 row">
              <div class="col-1"></div>
             <div class="col-2">
                <label>@L["FaceBookPixelID"]</label>
            </div>
            <div class="col-5">
                <InputNumber class="form-control"   @bind-Value="@EditGroupBuyDto.MetaPixelNo" />
            </div>
            </div>
             <div class=" col-12 row">
              <div class="col-1"></div>
             <div class="col-2">
                <label>@L["FaceBookID"]</label>
            </div>
            <div class="col-5">
                <TextEdit    @bind-Text="@EditGroupBuyDto.FBID" />
            </div>
            </div>
             <div class=" col-12 row">
              <div class="col-1"></div>
             <div class="col-2">
                <label>@L["IGID"]</label>
            </div>
            <div class="col-5">
                <TextEdit  @bind-Text="@EditGroupBuyDto.IGID" />
            </div>
            </div>
             <div class=" col-12 row">
              <div class="col-1"></div>
             <div class="col-2">
                <label>@L["LINEID"]</label>
            </div>
            <div class="col-5">
                <TextEdit  @bind-Text="@EditGroupBuyDto.LineID" />
            </div>
            </div>
             <div class=" col-12 row">
              <div class="col-1"></div>
             <div class="col-2">
                <label>@L["GAID"]</label>
            </div>
            <div class="col-5">
                <TextEdit  @bind-Text="@EditGroupBuyDto.GAID" />
            </div>
            </div>
             <div class=" col-12 row">
              <div class="col-1"></div>
             <div class="col-2">
                <label>@L["GTM"]</label>
            </div>
            <div class="col-5">
                <TextEdit  @bind-Text="@EditGroupBuyDto.GTM" />
            </div>
            </div>
    <Divider></Divider>
          <div class=" col-12 row">
              <div class="col-2"><label>@L["ChooseModule"]</label></div>
          
            <div class="col-3">
                <Dropdown>
    <DropdownToggle Color="Color.Primary">
        Dropdown
    </DropdownToggle>
    <DropdownMenu>
        <DropdownItem Clicked='@(()=>addProductItem("Product Image"))'>
      
         Product Picture</DropdownItem>
        <DropdownDivider />
        <DropdownItem Clicked='@(()=>addProductItem("Product Description"))'>
       
            Product Description</DropdownItem>
    </DropdownMenu>
</Dropdown>
              
            </div>
            </div>
            @foreach (var module in CollapseItem)
                {
                    <div class=" col-12 row">
                    <div class="col-2"></div>
                    <div class="col-7">

                        <Accordion>
                  <Collapse>
                            <CollapseHeader>
                                <AccordionToggle>@module.Title</AccordionToggle>
                            </CollapseHeader>
                            <CollapseBody>
                                
                                <div class="row mt-2">
                                        <div class="col-3 mt-2">
                                            @L["SelectItem"]
                                        </div>
                                        <div class="col-9">
                                            <Autocomplete TItem="KeyValueDto"
                                                          TValue="Guid?"
                                                          Data="@ItemsList"
                                                          TextField="@(( item ) => item.Name)"
                                                          ValueField="@(( item ) => item.Id)"
                                                          @bind-SelectedText="SelectedAutoCompleteText"
                                                          Placeholder="Search..."
                                                          Filter="AutocompleteFilter.StartsWith"
                                                          CustomFilter="@(( item, searchValue ) => item.Name.IndexOf( searchValue, 0, StringComparison.CurrentCultureIgnoreCase ) >= 0 )"
                                                          HighlightSearch
                                                          Immediate="true"
                                                          SelectedValueChanged="(id) => OnSelectedValueChanged(id, module)"
                                                          @ref="AutocompleteField">
                                                <NotFoundContent> @L["NotFound"] </NotFoundContent>
                                            </Autocomplete>
                                        </div>
                                </div>
                                  
                                    
                                <div class="row">
                                    <div class="col-3 mt-2">
                                        @L["ProductImage"]
                                    </div>
                                    <div class="col-9 mt-2">
                                        @if(module.SelectedImage == null || module.SelectedImage.ImageUrl.IsNullOrWhiteSpace())
                                        {
                                            <Field>
                                                <FilePicker @ref="FilePicker"
                                                    Changed="(e) => OnFileUploadAsync(e, module)"
                                                    ShowMode="FilePickerShowMode.List"
                                                            Accept=".jpg, .png, .svg ,.jpeg, .webp">
                                                    <FileTemplate>
                                                        <Div Flex="Flex.JustifyContent.Between">
                                                            <Div>
                                                                <Heading Size="HeadingSize.Is6">@context.File.Name</Heading>
                                                                <Paragraph>@FilePicker.GetFileSizeReadable(context.File)</Paragraph>
                                                            </Div>
                                                            <Div Class="ps-2">
                                                                <Div>
                                                                @if (context.File.Status == FileEntryStatus.Ready)
                                                                {
                                                                    <Icon TextColor="TextColor.Primary" Name="IconName.FileUpload" />
                                                                }
                                                                else if (context.File.Status == FileEntryStatus.Uploading)
                                                                {
                                                                    <Icon TextColor="TextColor.Warning" Name="IconName.Bolt" />
                                                                }
                                                                else if (context.File.Status == FileEntryStatus.Uploaded)
                                                                {
                                                                    <Icon TextColor="TextColor.Success" Name="IconName.CheckCircle" />
                                                                }
                                                                else if (context.File.Status == FileEntryStatus.Error)
                                                                {
                                                                    <Icon TextColor="TextColor.Danger" Name="IconName.TimesCircle" />
                                                                }
                                                            </Div>
                                                            </Div>
                                                        </Div>
                                                    </FileTemplate>
                                                    <ButtonsTemplate>
                                                        <Progress Value="@FilePicker.GetProgressPercentage()" />
                                                    </ButtonsTemplate>
                                                </FilePicker>
                                            </Field>
                                        }
                                        else
                                        {
                                            <div class="d-flex">
                                                <div class="image-container">
                                                    <Image class="blur-image" Source="@module.SelectedImage.ImageUrl" Text="Item Image" Fluid />
                                                     <button class="delete-button" @onclick="() => DeleteImageAsync(module)">
                                                         <i class="fa fa-trash"></i>
                                                     </button>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>
                                        
                                <div class="row">
                                    <div class="col-3 mt-2">
                                        @L["ProductDescription"]
                                    </div>
                                    <div class="col-9 mt-2">
                                        <TextEdit MaxLength="60" ShowCount @bind-Text="@module.SelectedItemDescription" />
                                    </div>
                                </div>
                                <div class="d-flex flex-row-reverse mt-2">
                                    <Button class="btn btn-primary" Clicked="@(()=>HandleClick(module.Index))" Type="@ButtonType.Button"><span class="fa fas-plus"></span>Add Item</Button>
                                </div>
                               
                                <Divider></Divider>
                                @foreach (var item in module.ItemDetails)
                                {
                                    <div class="row col-12 ">
                                        <div class="col-3">
                                            <Image style="height:50px; width:auto;" Source="@item.Image.ImageUrl"></Image>
                                        </div>
                                         <div class="col-2">
                                            <p> @item.Item.ItemName</p>
                                        </div>
                                        <div class="col-6">
                                            <p> @item.ItemDescription</p>
                                        </div>
                                        <div class="col-1"> <Button class="close" Clicked="@(()=>RemoveProductItem(@item,@module.Index))"><span aria-hidden="true">&times;</span></Button></div>
                                    </div>
                                    <Divider></Divider>
                                }
                            </CollapseBody>
                        </Collapse>
</Accordion>
</div>
            <div class="col-1"> 
                    <Button class="btn btn-danger" Clicked="@(()=>RemoveCollapseItem(@module.Index))">
                        <i class="fa fa-trash"></i>
                    </Button>
                </div>
</div>
}
    <Divider></Divider>
    <div class=" col-12 row">
   
    <div class="col-2">
        <fieldLabel>@L["GroupBuyPolicy"]</fieldLabel>
    </div>
    <div class="col-9">
        <div class="col-12">
            <FieldLabel></FieldLabel>
            <TextEdit Placeholder="@L["GroupBuyCondition"]" @bind-Text="EditGroupBuyDto.GroupBuyCondition" MaxLength="60"  />
        </div>
        <div class=" col-12">
            <Blazored.TextEditor.BlazoredTextEditor @ref="@GroupBuyHtml">
                <ToolbarContent>
                    <select class="ql-header">
                        <option selected=""></option>
                        <option value="1"></option>
                        <option value="2"></option>
                        <option value="3"></option>
                        <option value="4"></option>
                        <option value="5"></option>
                    </select>
                    <span class="ql-formats">
                        <button class="ql-bold"></button>
                        <button class="ql-italic"></button>
                        <button class="ql-underline"></button>
                        <button class="ql-strike"></button>
                    </span>
                    <span class="ql-formats">
                        <select class="ql-color"></select>
                        <select class="ql-background"></select>
                    </span>
                    <span class="ql-formats">
                        <button class="ql-list" value="ordered"></button>
                        <button class="ql-list" value="bullet"></button>
                    </span>
                    <span class="ql-formats">
                        <button class="ql-link"></button>
                    </span>
                    <span class="ql-formats">
                        <button class="ql-image"></button>
                    </span>
                     <span class="ql-formats">
                        <button class="ql-video"></button>
                    </span>
                </ToolbarContent>
            </Blazored.TextEditor.BlazoredTextEditor>
       
        </div>
    </div>
    <div class="col-1">
        <span>
           
        </span>
    </div>
</div>
 <div class=" col-12 row">
    
     <div class="col-2">
         <fieldLabel></fieldLabel>
     </div>
     <div class="col-9">
         <div class="col-12">
             <fieldLabel></fieldLabel>
             <TextEdit Placeholder="@L["CustomerInformation"]" @bind-Text="@EditGroupBuyDto.CustomerInformation" MaxLength="60"  />
         </div>
         <div class=" col-12">
             <Blazored.TextEditor.BlazoredTextEditor @ref="@CustomerInformationHtml">
                 <ToolbarContent>
                     <select class="ql-header">
                         <option selected=""></option>
                         <option value="1"></option>
                         <option value="2"></option>
                         <option value="3"></option>
                         <option value="4"></option>
                         <option value="5"></option>
                     </select>
                     <span class="ql-formats">
                         <button class="ql-bold"></button>
                         <button class="ql-italic"></button>
                         <button class="ql-underline"></button>
                         <button class="ql-strike"></button>
                     </span>
                     <span class="ql-formats">
                         <select class="ql-color"></select>
                         <select class="ql-background"></select>
                     </span>
                     <span class="ql-formats">
                         <button class="ql-list" value="ordered"></button>
                         <button class="ql-list" value="bullet"></button>
                     </span>
                     <span class="ql-formats">
                         <button class="ql-link"></button>
                     </span>
                     <span class="ql-formats">
                         <button class="ql-image"></button>
                     </span>
                      <span class="ql-formats">
                         <button class="ql-video"></button>
                     </span>
                 </ToolbarContent>
             </Blazored.TextEditor.BlazoredTextEditor>
         </div>
     </div>
     <div class="col-1">
         <span>
            
         </span>
     </div>
 </div>
     <div class=" col-12 row">
    
     <div class="col-2">
         <fieldLabel></fieldLabel>
     </div>
     <div class="col-9">
         <div class="col-12">
             <fieldLabel></fieldLabel>
             <TextEdit Placeholder="@L["ExchangePolicy"]" @bind-Text="@EditGroupBuyDto.ExchangePolicy" MaxLength="60" ShowCount />
         </div>
         <div class=" col-12">
             <Blazored.TextEditor.BlazoredTextEditor @ref="@ExchangePolicyHtml">
                 <ToolbarContent>
                     <select class="ql-header">
                         <option selected=""></option>
                         <option value="1"></option>
                         <option value="2"></option>
                         <option value="3"></option>
                         <option value="4"></option>
                         <option value="5"></option>
                     </select>
                     <span class="ql-formats">
                         <button class="ql-bold"></button>
                         <button class="ql-italic"></button>
                         <button class="ql-underline"></button>
                         <button class="ql-strike"></button>
                     </span>
                     <span class="ql-formats">
                         <select class="ql-color"></select>
                         <select class="ql-background"></select>
                     </span>
                     <span class="ql-formats">
                         <button class="ql-list" value="ordered"></button>
                         <button class="ql-list" value="bullet"></button>
                     </span>
                     <span class="ql-formats">
                         <button class="ql-link"></button>
                     </span>
                     <span class="ql-formats">
                         <button class="ql-image"></button>
                     </span>
                      <span class="ql-formats">
                         <button class="ql-video"></button>
                     </span>
                 </ToolbarContent>
             </Blazored.TextEditor.BlazoredTextEditor>
         </div>
     </div>
     <div class="col-1">
         <span>
            
         </span>
     </div>
 </div>
     <div class=" col-12 row">

         <div class="col-2">
             <fieldLabel>@L["NotifyEmail"]</fieldLabel>
         </div>
         <div class="col-9">
             <div class="col-12">
                 <fieldLabel></fieldLabel>

             </div>
             <div class=" col-12">
                 <Blazored.TextEditor.BlazoredTextEditor @ref="@NotifyEmailHtml">
                     <ToolbarContent>
                         <select class="ql-header">
                             <option selected=""></option>
                             <option value="1"></option>
                             <option value="2"></option>
                             <option value="3"></option>
                             <option value="4"></option>
                             <option value="5"></option>
                         </select>
                         <span class="ql-formats">
                             <button class="ql-bold"></button>
                             <button class="ql-italic"></button>
                             <button class="ql-underline"></button>
                             <button class="ql-strike"></button>
                         </span>
                         <span class="ql-formats">
                             <select class="ql-color"></select>
                             <select class="ql-background"></select>
                         </span>
                         <span class="ql-formats">
                             <button class="ql-list" value="ordered"></button>
                             <button class="ql-list" value="bullet"></button>
                         </span>
                         <span class="ql-formats">
                             <button class="ql-link"></button>
                         </span>
                         <span class="ql-formats">
                             <button class="ql-image"></button>
                         </span>
                         <span class="ql-formats">
                             <button class="ql-video"></button>
                         </span>
                     </ToolbarContent>
                 </Blazored.TextEditor.BlazoredTextEditor>
             </div>
         </div>
         <div class="col-1">
             <span>

             </span>
         </div>
     </div>
     <div class="row mb-3"></div>

        <div class="d-flex flex-row-reverse">
            <Button Type="@ButtonType.Button" class="btn btn-primary me-1" Clicked="UpdateEntityAsync"><i class="fa fa-check"></i> @L["Save"]</Button>

            <Button Danger Type="@ButtonType.Button" class="btn btn-danger me-1" Clicked="CloseGroupBuyEdit">@L["Cancel"]</Button>
             @*  <Button Type="@ButtonType.Button" class="btn btn-secondary me-1">@L["Preview"]</Button> *@

        </div>
    </CardBody>
    </Card>
    
    <Modal Title="@title"
       Visible="@_visible"
       OnOk="@HandleOk"
       OnCancel="@HandleCancel">
          
</Modal>


 @code {

    string title = "BasicModal";
    string customerInformation;
     string groupBuyCondition;
    string productDescription = "";
    bool _visible = false;
    int selectedIndex = 0;
    private void HandleClick(int i)
    {
        var checkValiate = CollapseItem.Where(x => x.Index == i).FirstOrDefault();
        if(checkValiate is null)
        {
            return;
        }
        if(checkValiate.SelectedItemId == null)
        {
            return;
        }
        if(checkValiate.SelectedItemDescription.IsNullOrWhiteSpace())
        {
            return;
        }
        if(checkValiate.SelectedImage == null || checkValiate.SelectedImage.ImageUrl.IsNullOrWhiteSpace())
        {
            return;
        }

        int selectedIndex = i;
        if (CollapseItem.Where(x => x.Index == i).FirstOrDefault().ItemDetails.Count <= 3)
        {
            var cItem = CollapseItem.Where(x => x.Index == i).FirstOrDefault();

            ProductPictureItem item = new ProductPictureItem
            {
                ItemId = cItem.SelectedItemId,
                ItemDescription = cItem.SelectedItemDescription,
                Image = cItem.SelectedImage,
                Item = cItem.SelectedItem
            };

            cItem.SelectedItemDescription = null;
            cItem.SelectedImage = new();

            CollapseItem.Where(x => x.Index == i).FirstOrDefault().ItemDetails.Add(item);
        }
    }

    private void HandleOk(MouseEventArgs e)
    {
        Console.WriteLine(e);
        _visible = false;
    }

    private void HandleCancel(MouseEventArgs e)
    {
        Console.WriteLine(e);
        _visible = false;
        selectedIndex = 0;
    }
       private void RemoveProductItem(ProductPictureItem item,int index)
    {
    CollapseItem.Where(x=>x.Index==index).FirstOrDefault().ItemDetails.Remove(item);
    }
    }





