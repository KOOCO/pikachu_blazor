@page "/Campaigns/Create"
@using Blazorise.FluentValidation
@using FluentValidation
@using Kooco.Pikachu.Blazor.Pages.Components.Icons
@using Kooco.Pikachu.Campaigns
@using Kooco.Pikachu.EnumValues
@using Kooco.Pikachu.GroupBuys
@using Kooco.Pikachu.Items
@using Kooco.Pikachu.Localization
@using Kooco.Pikachu.Members.MemberTags
@using Volo.Abp.AspNetCore.Components.Web
@inherits PikachuComponentBase
@inject NavigationManager NavigationManager
@inject IValidator<CreateCampaignDto> CreateCampaignValidator
@inject AbpBlazorMessageLocalizerHelper<PikachuResource> LH
@inject IGroupBuyAppService GroupBuyAppService
@inject IItemAppService ItemAppService
@inject IMemberTagAppService MemberTagAppService

<style>
    .form-group[indent] {
        width: calc(50% - 25px - 1rem);
        margin-left: 25px;
    }

    .form-group[mb0] {
        margin-bottom: 0px;
    }
</style>
<Div Class="rounded-cards">
    <Div Class="d-flex align-items-center">
        <PikachuButton Clicked="@Cancel">
            <Icon Name="IconName.ArrowLeft" Class="me-1"></Icon>
        </PikachuButton>
        <h4 class="text-dark m-0">
            @L["CreateNewCampaign"]
        </h4>
    </Div>
    <Form>
        <Validations @ref="ValidationsRef" Model="@Entity" ValidateOnLoad="false" HandlerType="typeof(FluentValidationHandler)">
            <EditForm EditContext="_editContext">
                <Row>
                    <Column ColumnSize="ColumnSize.Is9">
                        <Card>
                            <CardBody>
                                <Validation MessageLocalizer="@LH.Localize">
                                    <Field>
                                        <FieldLabel required>@L["CampaignName"]</FieldLabel>
                                        <TextEdit @bind-Text="Entity.Name" Placeholder="@L["EnterCampaignName"]">
                                            <Feedback>
                                                <ValidationError />
                                            </Feedback>
                                        </TextEdit>
                                    </Field>
                                </Validation>
                                <Row>
                                    <Column ColumnSize="ColumnSize.Is6">
                                        <Validation MessageLocalizer="@LH.Localize">
                                            <Field>
                                                <FieldLabel required>@L["StartDate"]</FieldLabel>
                                                <DatePicker TValue="DateTime?" @bind-Date="Entity.StartDate">
                                                    <Feedback>
                                                        <ValidationError />
                                                    </Feedback>
                                                </DatePicker>
                                            </Field>
                                        </Validation>
                                    </Column>
                                    <Column ColumnSize="ColumnSize.Is6">
                                        <Validation MessageLocalizer="@LH.Localize">
                                            <Field>
                                                <FieldLabel required>@L["EndDate"]</FieldLabel>
                                                <DatePicker TValue="DateTime?" @bind-Date="Entity.EndDate">
                                                    <Feedback>
                                                        <ValidationError />
                                                    </Feedback>
                                                </DatePicker>
                                            </Field>
                                        </Validation>
                                    </Column>
                                </Row>
                                <Validation MessageLocalizer="@LH.Localize">
                                    <Field>
                                        <FieldLabel>@L["CampaignDescription"]</FieldLabel>
                                        <MemoEdit Rows="7" @bind-Text="Entity.Description" Placeholder="@L["EnterCampaignDescription"]">
                                            <Feedback>
                                                <ValidationError />
                                            </Feedback>
                                        </MemoEdit>
                                    </Field>
                                </Validation>
                                <Field>
                                    <FieldLabel required>@L["TargetAudience"]</FieldLabel>
                                    <AntDesign.Select Mode="AntDesign.SelectMode.Multiple"
                                                      Size="AntDesign.InputSize.Large"
                                                      TItem="string"
                                                      TItemValue="string"
                                                      MaxTagCount="AntDesign.Select.ResponsiveTag.Responsive"
                                                      EnableSearch
                                                      AllowClear
                                                      Class="@ValidationClass(nameof(Entity.TargetAudience))"
                                                      @bind-Values="Entity.TargetAudience">
                                        <SelectOptions>
                                            @foreach (var item in TargetAudienceOptions)
                                            {
                                                <AntDesign.SelectOption TItemValue="string" TItem="string" Value=@item Label=@L[item] />
                                            }
                                        </SelectOptions>
                                    </AntDesign.Select>
                                    <ValidationMessage For="() => Entity.TargetAudience" />
                                </Field>
                                <Field>
                                    <FieldLabel required>@L["PromotionModule"]</FieldLabel>
                                    <Div Class="promotion-modules">
                                        @foreach (PromotionModule module in Enum.GetValues<PromotionModule>())
                                        {
                                            <div class="promotion-module @(Entity.PromotionModule == module ? "active" : "")" @onclick="(() => Entity.PromotionModule = module)">
                                                <PromotionModulesSvg Module="module"></PromotionModulesSvg>
                                                <h4 class="module-title">@L["Enum:PromotionModule." + (int)module]</h4>
                                                <text class="module-description">@L["Enum:PromotionModuleDescription." + (int)module]</text>
                                            </div>
                                        }
                                    </Div>
                                    <ValidationMessage For="() => Entity.PromotionModule" />
                                </Field>
                                @if (Entity.PromotionModule.HasValue)
                                {
                                    <Divider></Divider>
                                }

                                @if (Entity.PromotionModule == PromotionModule.Discount)
                                {
                                    <Validation MessageLocalizer="@LH.Localize">
                                        <Field>
                                            <FieldLabel required>@L["DiscountCode"]</FieldLabel>
                                            <RadioGroup Orientation="Orientation.Vertical" TValue="bool?" Name="DiscountCode" @bind-CheckedValue="@Entity.Discount.IsDiscountCodeRequired">
                                                <ChildContent>
                                                    <Radio TValue="bool?" Value="@false">@L["NoCodeRequiredForDiscount"]</Radio>
                                                    <Radio TValue="bool?" Value="@true">@L["CustomCode"]</Radio>
                                                </ChildContent>
                                                <Feedback>
                                                    <ValidationError />
                                                </Feedback>
                                            </RadioGroup>
                                            @if (Entity.Discount.IsDiscountCodeRequired == true)
                                            {
                                                <Validation MessageLocalizer="@LH.Localize">
                                                    <Field indent mb0>
                                                        <TextEdit @bind-Text="Entity.Discount.DiscountCode">
                                                            <Feedback>
                                                                <ValidationError />
                                                            </Feedback>
                                                        </TextEdit>
                                                    </Field>
                                                </Validation>
                                            }
                                        </Field>
                                    </Validation>
                                    <Row>
                                        <Column ColumnSize="ColumnSize.Is6">
                                            <Validation MessageLocalizer="@LH.Localize">
                                                <Field>
                                                    <FieldLabel required>@L["NoOfIssuedCodes"]</FieldLabel>
                                                    <NumericEdit @bind-Value="Entity.Discount.AvailableQuantity" TValue="int" Min="0">
                                                        <Feedback>
                                                            <ValidationError />
                                                        </Feedback>
                                                    </NumericEdit>
                                                </Field>
                                            </Validation>
                                        </Column>
                                        <Column ColumnSize="ColumnSize.Is6">
                                            <Validation MessageLocalizer="@LH.Localize">
                                                <Field>
                                                    <FieldLabel required>@L["MaximumUsePerPerson"]</FieldLabel>
                                                    <NumericEdit @bind-Value="Entity.Discount.MaximumUsePerPerson" TValue="int" Min="0">
                                                        <Feedback>
                                                            <ValidationError />
                                                        </Feedback>
                                                    </NumericEdit>
                                                </Field>
                                            </Validation>
                                        </Column>
                                    </Row>
                                    <Divider></Divider>
                                    <Validation MessageLocalizer="@LH.Localize">
                                        <Field>
                                            <FieldLabel required>@L["DiscountMethod"]</FieldLabel>
                                            <RadioGroup Orientation="Orientation.Vertical" TValue="DiscountMethod?" Name="DiscountMethod" @bind-CheckedValue="@Entity.Discount.DiscountMethod">
                                                <ChildContent>
                                                    @foreach (DiscountMethod discountMethod in Enum.GetValues<DiscountMethod>())
                                                    {
                                                        <Radio TValue="DiscountMethod?" Value="@discountMethod">@L["Enum:DiscountMethod." + (int)discountMethod]</Radio>
                                                        @if (discountMethod == DiscountMethod.MinimumSpendAmount && Entity.Discount.DiscountMethod == DiscountMethod.MinimumSpendAmount)
                                                        {
                                                            <Validation MessageLocalizer="@LH.Localize">
                                                                <Field indent mb0>
                                                                    <NumericEdit @bind-Value="Entity.Discount.MinimumSpendAmount" TValue="int" Min="0">
                                                                        <Feedback>
                                                                            <ValidationError />
                                                                        </Feedback>
                                                                    </NumericEdit>
                                                                </Field>
                                                            </Validation>
                                                        }
                                                    }
                                                </ChildContent>
                                                <Feedback>
                                                    <ValidationError />
                                                </Feedback>
                                            </RadioGroup>
                                        </Field>
                                    </Validation>
                                    @if (Entity.Discount.DiscountMethod == DiscountMethod.ShippingDiscount)
                                    {
                                        <Validation MessageLocalizer="@LH.Localize">
                                            <Field>
                                                <FieldLabel required>@L["ShippingDiscountSettings"]</FieldLabel>
                                                <RadioGroup Orientation="Orientation.Vertical" TValue="bool?" Name="ShippingDiscountSettings" @bind-CheckedValue="@Entity.Discount.ApplyToAllShippingMethods">
                                                    <ChildContent>
                                                        <Radio TValue="bool?" Value="@true">@L["AllMethods"]</Radio>
                                                        <Radio TValue="bool?" Value="@false">@L["SpecificMethods"]</Radio>
                                                    </ChildContent>
                                                    <Feedback>
                                                        <ValidationError />
                                                    </Feedback>
                                                </RadioGroup>
                                                @if (Entity.Discount.ApplyToAllShippingMethods == false)
                                                {
                                                    <Validation MessageLocalizer="@LH.Localize">
                                                        <Field indent mb0>
                                                            <AntDesign.Select Mode="AntDesign.SelectMode.Multiple"
                                                                              Size="AntDesign.InputSize.Large"
                                                                              TItem="DeliveryMethod"
                                                                              TItemValue="DeliveryMethod"
                                                                              Placeholder="@L["SelectShippingMethods"]"
                                                                              EnableSearch
                                                                              AllowClear
                                                                              MaxTagCount="AntDesign.Select.ResponsiveTag.Responsive"
                                                                              Class="@ValidationClass(nameof(Entity.Discount.DeliveryMethods))"
                                                                              @bind-Values="Entity.Discount.DeliveryMethods">
                                                                <SelectOptions>
                                                                    @foreach (var item in DeliveryMethodOptions)
                                                                    {
                                                                        <AntDesign.SelectOption TItemValue="DeliveryMethod" TItem="DeliveryMethod" Value="item" Label="@L[item.ToString()]" />
                                                                    }
                                                                </SelectOptions>
                                                            </AntDesign.Select>
                                                            <ValidationMessage For="() => Entity.Discount.DeliveryMethods" />
                                                        </Field>
                                                    </Validation>
                                                }
                                            </Field>
                                        </Validation>
                                    }
                                    <Divider></Divider>
                                    <Validation MessageLocalizer="@LH.Localize">
                                        <Field>
                                            <FieldLabel required>@L["DiscountAmount"]</FieldLabel>
                                            <RadioGroup Orientation="Orientation.Vertical" TValue="DiscountType?" @bind-CheckedValue="Entity.Discount.DiscountType">
                                                <ChildContent>
                                                    <Radio TValue="DiscountType?" Value="@DiscountType.FixedAmount">@L["DiscountOf$"]</Radio>
                                                    @if (Entity.Discount.DiscountType == DiscountType.FixedAmount)
                                                    {
                                                        <Validation MessageLocalizer="@LH.Localize">
                                                            <Field indent mb0>
                                                                <NumericEdit @bind-Value="Entity.Discount.DiscountAmount" TValue="int?" Min="0">
                                                                    <Feedback>
                                                                        <ValidationError />
                                                                    </Feedback>
                                                                </NumericEdit>
                                                            </Field>
                                                        </Validation>
                                                    }
                                                    <Radio TValue="DiscountType?" Value="@DiscountType.Percentage">@L["DiscountOf%"]</Radio>
                                                    @if (Entity.Discount.DiscountType == DiscountType.Percentage)
                                                    {
                                                        <Validation MessageLocalizer="@LH.Localize">
                                                            <Field indent mb0>
                                                                <NumericEdit @bind-Value="Entity.Discount.DiscountPercentage" TValue="int?" Min="0" Max="100">
                                                                    <Feedback>
                                                                        <ValidationError />
                                                                    </Feedback>
                                                                </NumericEdit>
                                                            </Field>
                                                        </Validation>
                                                    }
                                                </ChildContent>
                                                <Feedback>
                                                    <ValidationError />
                                                </Feedback>
                                            </RadioGroup>
                                        </Field>
                                    </Validation>
                                }

                                @if (Entity.PromotionModule == PromotionModule.ShoppingCredit)
                                {
                                    <Validation MessageLocalizer="@LH.Localize">
                                        <Field>
                                            <FieldLabel required>@L["UsagePeriod"]</FieldLabel>
                                            <RadioGroup Orientation="Orientation.Vertical" TValue="bool?" Name="UsagePeriod" @bind-CheckedValue="@Entity.ShoppingCredit.CanExpire">
                                                <ChildContent>
                                                    <Radio TValue="bool?" Value="@false">@L["NoExpiry"]</Radio>
                                                    <Radio TValue="bool?" Value="@true">@L["Limited,validfordays"]</Radio>
                                                </ChildContent>
                                                <Feedback>
                                                    <ValidationError />
                                                </Feedback>
                                            </RadioGroup>
                                            @if (Entity.ShoppingCredit.CanExpire == true)
                                            {
                                                <Validation MessageLocalizer="@LH.Localize">
                                                    <Field indent mb0>
                                                        <NumericEdit @bind-Value="Entity.ShoppingCredit.ValidForDays">
                                                            <Feedback>
                                                                <ValidationError />
                                                            </Feedback>
                                                        </NumericEdit>
                                                    </Field>
                                                </Validation>
                                            }
                                        </Field>
                                    </Validation>
                                    <Divider></Divider>
                                    <Validation MessageLocalizer="@LH.Localize">
                                        <Field>
                                            <FieldLabel required>@L["CalculationMethod"]</FieldLabel>
                                            <RadioGroup Orientation="Orientation.Vertical" TValue="CalculationMethod?" Name="CalculationMethod" @bind-CheckedValue="@Entity.ShoppingCredit.CalculationMethod">
                                                <ChildContent>
                                                    <Radio TValue="CalculationMethod?" Value="@CalculationMethod.UnifiedCalculation">@L["Enum:CalculationMethod." + (int)CalculationMethod.UnifiedCalculation]</Radio>
                                                    @if (Entity.ShoppingCredit.CalculationMethod == CalculationMethod.UnifiedCalculation)
                                                    {
                                                        <Validation MessageLocalizer="@LH.Localize">
                                                            <Field indent mb0>
                                                                <Addons>
                                                                    <AddonLabel>%</AddonLabel>
                                                                    <Addon AddonType="AddonType.Body">
                                                                        <NumericEdit TValue="double?" @bind-Value="Entity.ShoppingCredit.CalculationPercentage">
                                                                            <Feedback>
                                                                                <ValidationError />
                                                                            </Feedback>
                                                                        </NumericEdit>
                                                                    </Addon>
                                                                </Addons>
                                                            </Field>
                                                        </Validation>
                                                    }
                                                    <Radio TValue="CalculationMethod?" Value="@CalculationMethod.StagedCalculation">@L["Enum:CalculationMethod." + (int)CalculationMethod.StagedCalculation]</Radio>
                                                </ChildContent>
                                                <Feedback>
                                                    <ValidationError />
                                                </Feedback>
                                            </RadioGroup>
                                        </Field>
                                    </Validation>
                                    @if (Entity.ShoppingCredit.CalculationMethod == CalculationMethod.StagedCalculation)
                                    {
                                        <Div>
                                            <Div Class="d-flex align-items-center justify-content-between">
                                                <FieldLabel>@L["StageSettings"]</FieldLabel>
                                                <Div>
                                                    @if (Entity.ShoppingCredit.IsAnyStageSettingSelected)
                                                    {
                                                        <PikachuButton Class="pk-btn-icon danger" IconClass="fas fa-trash" Clicked="Entity.ShoppingCredit.RemoveSelectedStageSettings"></PikachuButton>
                                                        <Span Style="margin-right: 5px;"></Span>
                                                    }
                                                    <PikachuButton Class="pk-btn-icon indigo" IconClass="fas fa-add" Clicked="Entity.ShoppingCredit.AddStageSetting"></PikachuButton>
                                                </Div>
                                            </Div>
                                            @foreach (var stageSetting in Entity.ShoppingCredit.StageSettings)
                                            {
                                                <Row>
                                                    @if (Entity.ShoppingCredit.StageSettingsCount > 1)
                                                    {
                                                        <Column ColumnSize="ColumnSize.Is1" Class="d-flex align-items-center justify-content-end">
                                                            <InputCheckbox class="form-check-input" @bind-Value="stageSetting.IsSelected" />
                                                        </Column>
                                                    }
                                                    <Column ColumnSize="Entity.ShoppingCredit.StageSettingsCount > 1 ? ColumnSize.Is5 : ColumnSize.Is6">
                                                        <Validation MessageLocalizer="@LH.Localize">
                                                            <Field>
                                                                <FieldLabel required>@L["Spend"]</FieldLabel>
                                                                <NumericEdit TValue="int?" @bind-Value="stageSetting.Spend">
                                                                    <Feedback>
                                                                        <ValidationError />
                                                                    </Feedback>
                                                                </NumericEdit>
                                                            </Field>
                                                        </Validation>
                                                    </Column>
                                                    <Column ColumnSize="ColumnSize.Is6">
                                                        <Validation MessageLocalizer="@LH.Localize">
                                                            <Field>
                                                                <FieldLabel required>@L["ToReceivePoints"]</FieldLabel>
                                                                <NumericEdit TValue="int?" @bind-Value="stageSetting.PointsToReceive">
                                                                    <Feedback>
                                                                        <ValidationError />
                                                                    </Feedback>
                                                                </NumericEdit>
                                                            </Field>
                                                        </Validation>
                                                    </Column>
                                                </Row>
                                            }
                                            <ValidationMessage For="() => Entity.ShoppingCredit.StageSettings" />
                                        </Div>
                                    }
                                    <Divider></Divider>
                                    <Validation MessageLocalizer="@LH.Localize">
                                        <Field>
                                            <FieldLabel required>@L["ApplicableItems"]</FieldLabel>
                                            <RadioGroup Orientation="Orientation.Vertical" TValue="ApplicableItem?" Name="ApplicableItems" @bind-CheckedValue="@Entity.ShoppingCredit.ApplicableItem">
                                                <ChildContent>
                                                    <Radio TValue="ApplicableItem?" Value="@ApplicableItem.AddOnProducts">@L["Enum:ApplicableItem." + (int)ApplicableItem.AddOnProducts]</Radio>
                                                    <Radio TValue="ApplicableItem?" Value="@ApplicableItem.ShippingFees">@L["Enum:ApplicableItem." + (int)ApplicableItem.ShippingFees]</Radio>
                                                </ChildContent>
                                                <Feedback>
                                                    <ValidationError />
                                                </Feedback>
                                            </RadioGroup>
                                        </Field>
                                    </Validation>
                                    <Divider></Divider>
                                    <Field>
                                        <FieldLabel required>@L["Budget"]</FieldLabel>
                                        <AntDesign.InputNumber Size="AntDesign.InputSize.Large"
                                                               Class="@(ValidationClass(nameof(Entity.ShoppingCredit.Budget)) + " no-stepper")"
                                                               TValue="int?"
                                                               Min="0"
                                                               Formatter="AntHelper.FormatAmount"
                                                               Parser="AntHelper.ParseAmount"
                                                               OnChange="() => _editContext.NotifyFieldChanged(new FieldIdentifier(Entity.ShoppingCredit, nameof(Entity.ShoppingCredit.Budget)))"
                                                               @bind-Value="Entity.ShoppingCredit.Budget">
                                        </AntDesign.InputNumber>
                                        <ValidationMessage For="() => Entity.ShoppingCredit.Budget" />
                                    </Field>
                                }

                                @if (Entity.PromotionModule == PromotionModule.AddOnProduct)
                                {
                                    <Field>
                                        <FieldLabel required>@L["AddOnProduct"]</FieldLabel>
                                        <AntDesign.Select Size="AntDesign.InputSize.Large"
                                                          TItem="Guid?"
                                                          TItemValue="Guid?"
                                                          Placeholder="@L["SelectaProduct"]"
                                                          EnableSearch
                                                          AllowClear
                                                          Class="@ValidationClass(nameof(Entity.AddOnProduct.AddOnProductId))"
                                                          @bind-Value="Entity.AddOnProduct.AddOnProductId">
                                            <SelectOptions>
                                                @foreach (var item in ProductOptions)
                                                {
                                                    <AntDesign.SelectOption TItemValue="Guid?" TItem="Guid?" Value=@item.Id Label=@item.Name />
                                                }
                                            </SelectOptions>
                                        </AntDesign.Select>
                                        <ValidationMessage For="() => Entity.AddOnProduct.AddOnProductId" />
                                    </Field>
                                    <Row>
                                        <Column ColumnSize="ColumnSize.Is6">
                                            <Validation MessageLocalizer="@LH.Localize">
                                                <Field>
                                                    <FieldLabel required>@L["AddOnProductAmount"]</FieldLabel>
                                                    <NumericEdit @bind-Value="Entity.AddOnProduct.AddOnProductAmount" TValue="int?" Min="0">
                                                        <Feedback>
                                                            <ValidationError />
                                                        </Feedback>
                                                    </NumericEdit>
                                                </Field>
                                            </Validation>
                                        </Column>
                                        <Column ColumnSize="ColumnSize.Is6">
                                            <Validation MessageLocalizer="@LH.Localize">
                                                <Field>
                                                    <FieldLabel required>@L["AddOnLimitPerOrder"]</FieldLabel>
                                                    <NumericEdit @bind-Value="Entity.AddOnProduct.AddOnLimitPerOrder" TValue="int?" Min="0">
                                                        <Feedback>
                                                            <ValidationError />
                                                        </Feedback>
                                                    </NumericEdit>
                                                </Field>
                                            </Validation>
                                        </Column>
                                    </Row>
                                    <Validation MessageLocalizer="@LH.Localize">
                                        <Field>
                                            <FieldLabel required>@L["AvailableQuantity"]</FieldLabel>
                                            <RadioGroup Orientation="Orientation.Vertical" TValue="bool?" Name="AvailableQuantity" @bind-CheckedValue="@Entity.AddOnProduct.IsUnlimitedQuantity">
                                                <ChildContent>
                                                    <Radio TValue="bool?" Value="@true">@L["Unlimited"]</Radio>
                                                    <Radio TValue="bool?" Value="@false">@L["AvailableQuantity"]</Radio>
                                                </ChildContent>
                                                <Feedback>
                                                    <ValidationError />
                                                </Feedback>
                                            </RadioGroup>
                                            @if (Entity.AddOnProduct.IsUnlimitedQuantity == false)
                                            {
                                                <Validation MessageLocalizer="@LH.Localize">
                                                    <Field indent mb0>
                                                        <NumericEdit @bind-Value="Entity.AddOnProduct.AvailableQuantity">
                                                            <Feedback>
                                                                <ValidationError />
                                                            </Feedback>
                                                        </NumericEdit>
                                                        <FieldHelp>
                                                            @L["(Can'texceedthecurrentstockoftheoriginalproduct)"]
                                                        </FieldHelp>
                                                    </Field>
                                                </Validation>
                                            }
                                        </Field>
                                    </Validation>
                                    <Divider></Divider>
                                    <Validation MessageLocalizer="@LH.Localize">
                                        <Field>
                                            <FieldLabel required>@L["DisplayOfOriginalPrice"]</FieldLabel>
                                            <RadioGroup Orientation="Orientation.Vertical" TValue="AddOnDisplayPrice?" Name="DiscountMethod" @bind-CheckedValue="@Entity.AddOnProduct.AddOnDisplayPrice">
                                                <ChildContent>
                                                    @foreach (AddOnDisplayPrice addOnDisplayPrice in Enum.GetValues<AddOnDisplayPrice>())
                                                    {
                                                        <Radio TValue="AddOnDisplayPrice?" Value="@addOnDisplayPrice">@L["Enum:AddOnDisplayPrice." + (int)addOnDisplayPrice]</Radio>
                                                    }
                                                </ChildContent>
                                                <Feedback>
                                                    <ValidationError />
                                                </Feedback>
                                            </RadioGroup>
                                        </Field>
                                    </Validation>
                                    <Divider></Divider>
                                    <Validation MessageLocalizer="@LH.Localize">
                                        <Field>
                                            <FieldLabel required>@L["Conditions"]</FieldLabel>
                                            <RadioGroup Orientation="Orientation.Vertical" TValue="AddOnProductCondition?" Name="ProductCondition" @bind-CheckedValue="@Entity.AddOnProduct.AddOnProductCondition">
                                                <ChildContent>
                                                    @foreach (AddOnProductCondition addOnProductCondition in Enum.GetValues<AddOnProductCondition>())
                                                    {
                                                        <Radio TValue="AddOnProductCondition?" Value="@addOnProductCondition">@L["Enum:AddOnProductCondition." + (int)addOnProductCondition]</Radio>
                                                    }
                                                </ChildContent>
                                                <Feedback>
                                                    <ValidationError />
                                                </Feedback>
                                            </RadioGroup>
                                            @if (Entity.AddOnProduct.AddOnProductCondition == AddOnProductCondition.MustMeetSpecifiedThreshold)
                                            {
                                                <Validation MessageLocalizer="@LH.Localize">
                                                    <Field indent mb0>
                                                        <NumericEdit @bind-Value="Entity.AddOnProduct.Threshold">
                                                            <Feedback>
                                                                <ValidationError />
                                                            </Feedback>
                                                        </NumericEdit>
                                                    </Field>
                                                </Validation>
                                            }
                                        </Field>
                                    </Validation>
                                }

                                @if (Entity.PromotionModule.HasValue)
                                {
                                    <Divider></Divider>
                                    <Validation MessageLocalizer="@LH.Localize">
                                        <Field>
                                            <FieldLabel required>@L["Groupbuys"]</FieldLabel>
                                            <RadioGroup Orientation="Orientation.Vertical" TValue="bool?" Name="Groupbuys" @bind-CheckedValue="@Entity.ApplyToAllGroupBuys">
                                                <ChildContent>
                                                    <Radio TValue="bool?" Value="@true">@L["AllGroupBuys"]</Radio>
                                                    <Radio TValue="bool?" Value="@false">@L["SpecificGroupBuys"]</Radio>
                                                </ChildContent>
                                                <Feedback>
                                                    <ValidationError />
                                                </Feedback>
                                            </RadioGroup>
                                            @if (Entity.ApplyToAllGroupBuys == false)
                                            {
                                                <Field indent mb0>
                                                    <AntDesign.Select Mode="AntDesign.SelectMode.Multiple"
                                                                      Size="AntDesign.InputSize.Large"
                                                                      TItem="Guid"
                                                                      TItemValue="Guid"
                                                                      Placeholder="@L["SelectGroupBuys"]"
                                                                      EnableSearch
                                                                      AllowClear
                                                                      MaxTagCount="AntDesign.Select.ResponsiveTag.Responsive"
                                                                      Class="@ValidationClass(nameof(Entity.GroupBuyIds))"
                                                                      OnSelectedItemsChanged="() => _editContext.NotifyFieldChanged(new FieldIdentifier(Entity, nameof(Entity.GroupBuyIds)))"
                                                                      @bind-Values="Entity.GroupBuyIds">
                                                        <SelectOptions>
                                                            @foreach (var item in GroupBuyOptions)
                                                            {
                                                                <AntDesign.SelectOption TItemValue="Guid" TItem="Guid" Value=@item.Id Label=@item.Name />
                                                            }
                                                        </SelectOptions>
                                                    </AntDesign.Select>
                                                    <ValidationMessage For="() => Entity.GroupBuyIds" />
                                                </Field>
                                            }
                                        </Field>
                                    </Validation>
                                }

                                @if (Entity.PromotionModule == PromotionModule.Discount || Entity.PromotionModule == PromotionModule.ShoppingCredit)
                                {
                                    <Divider></Divider>
                                    <Validation MessageLocalizer="@LH.Localize">
                                        <Field>
                                            <FieldLabel required>@L["Products"]</FieldLabel>
                                            <RadioGroup Orientation="Orientation.Vertical" TValue="bool?" Name="Products" @bind-CheckedValue="@Entity.ApplyToAllProducts">
                                                <ChildContent>
                                                    <Radio TValue="bool?" Value="@true">@L["AllProducts"]</Radio>
                                                    <Radio TValue="bool?" Value="@false">@L["SpecificProducts"]</Radio>
                                                </ChildContent>
                                                <Feedback>
                                                    <ValidationError />
                                                </Feedback>
                                            </RadioGroup>
                                            @if (Entity.ApplyToAllProducts == false)
                                            {
                                                <Field indent mb0>
                                                    <AntDesign.Select Mode="AntDesign.SelectMode.Multiple"
                                                                      Size="AntDesign.InputSize.Large"
                                                                      TItem="Guid"
                                                                      TItemValue="Guid"
                                                                      Placeholder="@L["SelectProducts"]"
                                                                      EnableSearch
                                                                      AllowClear
                                                                      MaxTagCount="AntDesign.Select.ResponsiveTag.Responsive"
                                                                      Class="@ValidationClass(nameof(Entity.ProductIds))"
                                                                      OnSelectedItemsChanged="() => _editContext.NotifyFieldChanged(new FieldIdentifier(Entity, nameof(Entity.ProductIds)))"
                                                                      @bind-Values="Entity.ProductIds">
                                                        <SelectOptions>
                                                            @foreach (var item in ProductOptions)
                                                            {
                                                                <AntDesign.SelectOption TItemValue="Guid" TItem="Guid" Value=@item.Id Label=@item.Name />
                                                            }
                                                        </SelectOptions>
                                                    </AntDesign.Select>
                                                    <ValidationMessage For="() => Entity.ProductIds" />
                                                </Field>
                                            }
                                        </Field>
                                    </Validation>
                                }
                            </CardBody>
                        </Card>
                        <Div Class="text-end mt-2">
                            <PikachuButton Class="pk-btn-transparent" Disabled="Loading" Clicked="Cancel">@L["Cancel"]</PikachuButton>
                            <PikachuButton Class="pk-btn-primary" Loading="Loading" Clicked="Save">@L["CreateCampaign"]</PikachuButton>
                        </Div>
                    </Column>
                </Row>
            </EditForm>
        </Validations>
    </Form>
</Div>