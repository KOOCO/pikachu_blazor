@using System
@using Kooco.Pikachu.Blazor.Pages.Dashboard.DashboardBestSellers
@using Kooco.Pikachu.Blazor.Pages.Dashboard.DashboardCharts
@using Kooco.Pikachu.Blazor.Pages.Dashboard.DashboardOrdersTable
@using Kooco.Pikachu.Blazor.Pages.Dashboard.DashboardStats
@using Kooco.Pikachu.Dashboards
@using Kooco.Pikachu.GroupBuys
@using Kooco.Pikachu.Items.Dtos
@using Kooco.Pikachu.Reports
<link href="css/dashboard.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="js/dashboard.js"></script>

@attribute [Authorize]
@inherits PikachuComponentBase

@inject IDashboardAppService DashboardAppService
@inject IGroupBuyAppService GroupBuyAppService
@inject NavigationManager NavigationManager

<Card>
    <CardBody>
        <Row Gutter="(10, 10)">
            <Column ColumnSize="ColumnSize.Is12.Is6.OnDesktop.Is3.OnFullHD">
                <Label>@L["Period"]</Label>
                <AntDesign.Select @bind-Value="@Filters.SelectedPeriodOption"
                                  TItem="ReportCalculationUnits?"
                                  TItemValue="ReportCalculationUnits?">
                    <SelectOptions>
                        @foreach (var item in PeriodOptions)
                        {
                            <AntDesign.SelectOption TItemValue="ReportCalculationUnits?" TItem="ReportCalculationUnits?" Value=@item Label="@L[item.ToString()]" />
                        }
                    </SelectOptions>
                </AntDesign.Select>
            </Column>
            <Column ColumnSize="ColumnSize.Is12.Is6.OnDesktop.Is4.OnFullHD">
                <Label>@L["TimeRange"]</Label>
                <AntDesign.RangePicker TValue="DateTime?[]" Value="@Filters.SelectedDateRange" />
            </Column>
            <Column ColumnSize="ColumnSize.Is12.Is6.OnDesktop.Is4.OnFullHD">
                <Label>@L["SpecificGroupBuys"]</Label>
                <AntDesign.Select Mode="AntDesign.SelectMode.Multiple"
                                  @bind-Values="@Filters.SelectedGroupBuyIds"
                                  EnableSearch
                                  HideSelected
                                  TItem="Guid"
                                  TItemValue="Guid">
                    <SelectOptions>
                        @foreach (var item in GroupBuyOptions)
                        {
                            <AntDesign.SelectOption TItemValue="Guid" TItem="Guid" Value=@item.Id Label=@item.Name />
                        }
                    </SelectOptions>
                </AntDesign.Select>
            </Column>
            <Column ColumnSize="ColumnSize.Is12.Is1.OnDesktop">
                <Div Class="d-flex align-items-end justify-content-center h-100">
                    <PikachuButton Class="pk-btn-sm pk-btn-outline-primary w-100"
                                   IconClass="fas fa-filter" Clicked="ApplyFilters"
                                   Loading="IsLoading">
                    </PikachuButton>
                </Div>
            </Column>
        </Row>
    </CardBody>
</Card>

<Div>
    @* <DashboardStats Value="DashboardStats"></DashboardStats> *@
</Div>
<Div>
    <DashboardCharts @ref="_dashboardCharts"></DashboardCharts>
</Div>

<Row>
    <Column ColumnSize="ColumnSize.Is12.Is8.OnFullHD">
        <Card>
            <CardBody>
                <Div Class="d-flex align-items-center justify-content-between">
                    <h4 class="m-0">@L["RecentOrders"]</h4>
                    <Button Class="btn-link" Clicked="@(() => NavigationManager.NavigateTo("/Orders"))">@L["ViewAll"]</Button>
                </Div>
                <Divider></Divider>
                @* <DataGrid TItem="DashboardOrdersDto"
                          Data="RecentOrdersList"
                          ReadData="OnDataGridReadAsync"
                          TotalItems="RecentOrdersCount"
                          ShowPager="true"
                          PageSize="PageSize"
                          CurrentPage="CurrentPage"
                          Hoverable
                          Narrow
                          Responsive
                          @bind-SelectedRow="@SelectedMember"
                          SelectionMode="DataGridSelectionMode.Multiple"
                          @bind-SelectedRows="SelectedMembers"
                          RowSelectable="RowSelectableHandler">
                    <DataGridColumns>
                        <DataGridMultiSelectColumn TItem="MemberDto" Width="30px"></DataGridMultiSelectColumn>
                        <DataGridCommandColumn TItem="MemberDto" />
                        <DataGridColumn TItem="MemberDto"
                                        Field="@nameof(MemberDto.UserName)"
                                        Caption="@L["Name"]">
                            <DisplayTemplate>
                                <Div Class="d-flex align-items-center gap-1">
                                    <Div Class="member-image">
                                        <img class="img-fluid rounded-circle" src="https://e7.pngegg.com/pngimages/799/987/png-clipart-computer-icons-avatar-icon-design-avatar-heroes-computer-wallpaper-thumbnail.png" alt="Alternate Text" />
                                        @if (context.TotalOrders == 0)
                                        {
                                            <Badge>@L["New"]</Badge>
                                        }
                                    </Div>
                                    <Div>
                                        <Div>
                                            <Button Class="btn-link hyperlink fs-large" Clicked="() => EditMember(context)">@context.UserName</Button>
                                        </Div>
                                        <Span>@context.Email</Span>
                                    </Div>
                                </Div>
                            </DisplayTemplate>
                        </DataGridColumn>
                        <DataGridColumn TItem="MemberDto"
                                        Field="@nameof(MemberDto.PhoneNumber)"
                                        Caption="@L["Phone"]">
                        </DataGridColumn>
                        <DataGridColumn TItem="MemberDto"
                                        Field="@nameof(MemberDto.TotalOrders)"
                                        Caption="@L["Orders"]">
                            <DisplayTemplate>
                                @context.TotalOrders.ToString("N0")
                            </DisplayTemplate>
                        </DataGridColumn>
                        <DataGridColumn TItem="MemberDto"
                                        Field="@nameof(MemberDto.TotalSpent)"
                                        Caption="@L["Spent"]">
                            <DisplayTemplate>
                                $ @context.TotalSpent.ToString("N2")
                            </DisplayTemplate>
                        </DataGridColumn>
                    </DataGridColumns>
                </DataGrid> *@
            </CardBody>
        </Card>
    </Column>
    <Column ColumnSize="ColumnSize.Is12.Is4.OnFullHD">
        <DashboardBestSellers @ref="_bestSellers"></DashboardBestSellers>
    </Column>
</Row>